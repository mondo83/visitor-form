<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>来客受付フォーム</title>
  <style>
    :root {
      --primary-color: #006699;
      --bg-color: #f5f8fa;
      --card-bg: #ffffff;
      --border-radius: 8px;
      --spacing: 1rem;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-color);
      padding: var(--spacing);
    }
    main {
      max-width: 600px;
      margin: auto;
      background: var(--card-bg);
      padding: calc(var(--spacing) * 1.5);
      border-radius: var(--border-radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: var(--spacing);
    }
    #langSwitch {
      text-align: right;
      margin-bottom: 0.5em;
    }
    #langSwitch button {
      background: none;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      margin-left: 0.5em;
      font-size: 0.9rem;
    }
    label {
      display: block;
      margin-top: var(--spacing);
      font-weight: bold;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.25em;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    .name-pair {
      display: flex;
      gap: 0.5em;
      margin-top: 0.5em;
    }
    .name-pair input {
      flex: 1;
    }
    .purpose-group {
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      margin-top: 0.5em;
    }
    .purpose-item {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .purpose-item span {
      flex: 1;
    }
    .purpose-item input[type="checkbox"] {
      margin: 0;
      margin-left: auto;
    }
    .scroll-box {
      max-height: 240px;
      overflow-y: scroll;
      background: #fafafa;
      padding: 0.75em;
      border: 1px solid #ddd;
      border-radius: 4px;
      white-space: pre-wrap;
      margin-top: 0.5em;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .scroll-box ul {
      padding-left: 1.2em;
      margin: 0;
    }
    .scroll-box li {
      margin-bottom: 0.5em;
    }
    .btn {
      background: var(--primary-color);
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      margin-top: var(--spacing);
      transition: background 0.2s;
    }
    .btn:hover {
      background: #00557a;
    }
    .btn-small {
      padding: 0.5em;
      font-size: 0.9rem;
    }
    #msg {
      margin-top: var(--spacing);
      text-align: center;
      color: #d33;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <main>
    <div id="langSwitch">
      <button type="button" onclick="setLang('ja')">日本語</button>
      <button type="button" onclick="setLang('en')">English</button>
    </div>
    <h1 data-ja="来客受付" data-en="Visitor Check-in">来客受付</h1>
    <form id="visitorForm">
      <label for="visitDate" data-ja="ご来所日" data-en="Date of Visit">ご来所日</label>
      <input type="date" id="visitDate" name="visitDate" required>

      <label for="visitTime" data-ja="ご来所時間" data-en="Time of Arrival">ご来所時間</label>
      <input type="time" id="visitTime" name="visitTime" required>

      <label for="leaveTime" data-ja="予定ご退所時間" data-en="Expected Departure">予定ご退所時間</label>
      <input type="time" id="leaveTime" name="leaveTime">

      <label for="company" data-ja="貴社名（必須）" data-en="Company Name (required)">貴社名（必須）</label>
      <input type="text" id="company" name="company" required>

      <label data-ja="お名前・ビジターカード番号" data-en="Name & Visitor Card No.">お名前・ビジターカード番号</label>
      <div id="nameSection">
        <div class="name-pair">
          <input type="text" placeholder="お名前" data-en-placeholder="Name" required>
          <input type="number" placeholder="VC No." data-en-placeholder="Card No." required>
        </div>
      </div>
      <button type="button" class="btn btn-small" onclick="addNamePair()"
              data-ja="＋追加" data-en="+ Add">＋追加</button>

      <label data-ja="ご来所目的（複数選択可）" data-en="Purpose of Visit (multiple)">ご来所目的（複数選択可）</label>
      <div class="purpose-group">
        <label class="purpose-item">
          <span data-ja="調査・監査・見学" data-en="Inspection / Audit / Tour">調査・監査・見学</span>
          <input type="checkbox" name="purpose" value="調査・監査・見学">
        </label>
        <label class="purpose-item">
          <span data-ja="打合せ（会議）" data-en="Meeting">打合せ（会議）</span>
          <input type="checkbox" name="purpose" value="打合せ">
        </label>
        <label class="purpose-item">
          <span data-ja="納品・修理・清掃 他" data-en="Delivery / Repair / Cleaning">納品・修理・清掃 他</span>
          <input type="checkbox" name="purpose" value="納品・修理・清掃 他">
        </label>
      </div>

      <label data-ja="【注意事項】（必読）" data-en="Notes (must read)">【注意事項】（必読）</label>
      <div class="scroll-box">
        <ul>
          <li data-ja="試験エリアには化学物質や有機溶媒が置かれています…保護具（マスク、ゴーグル、グローブ、白衣）を貸与致しますので、弊社社員にお申し付けください。"
              data-en="In the testing area, chemical substances and organic solvents are stored. Contact may harm eyes or skin and cause health damage. Please wear protective clothing and, if needed, request protective gear (mask, goggles, gloves, lab coat).">試験エリアには化学物質や有機溶媒が置かれています…保護具（マスク、ゴーグル、グローブ、白衣）を貸与致しますので、弊社社員にお申し付けください。</li>
          <li data-ja="試験エリアには機器や設備が机上や足元に設置されています…衣服が破れたり、けがをする恐れがありますのでご注意願います。"
              data-en="In the testing area, equipment is placed on benches and floors. Contact may tear clothing or cause injury, so please be careful.">試験エリアには機器や設備が机上や足元に設置されています…衣服が破れたり、けがをする恐れがありますのでご注意願います。</li>
          <li data-ja="試験エリアで作業される際には…弊社社員の指示には必ず従っていただきますようお願いします。"
              data-en="When working in the testing area, take all safety precautions and follow staff instructions to avoid disrupting production.">試験エリアで作業される際には…弊社社員の指示には必ず従っていただきますようお願いします。</li>
          <li data-ja="サンプル保存エリアでは…ドアの開閉は速やかにお願いします。"
              data-en="In the sample storage area, avoid improper operation or damage to equipment. Report anomalies immediately and open/close doors quickly to minimize temperature changes.">サンプル保存エリアでは…ドアの開閉は速やかにお願いします。</li>
          <li data-ja="急な発熱や体調不良が発生した場合は…避難をお願いします。"
              data-en="If you develop a fever or feel unwell, contact staff. In case of fire or disaster, evacuate per staff instructions.">急な発熱や体調不良が発生した場合は…避難をお願いします。</li>
          <li data-ja="施設内ではビジターカード(VC)をご着用願います…飲食はご遠慮願います。"
              data-en="Please wear your visitor card (VC) and refrain from eating or drinking outside designated areas.">施設内ではビジターカード(VC)をご着用願います…飲食はご遠慮願います。</li>
          <li data-ja="知り得た情報の第三者開示、写真撮影、動画撮影は禁止します。"
              data-en="Disclosing facility information, photography, or video recording is prohibited.">知り得た情報の第三者開示、写真撮影、動画撮影は禁止します。</li>
          <li data-ja="当方の一方的過失以外の事故などについては…事故防止には万全を期してください。"
              data-en="We assume no liability except for sole negligence. Please take all precautions to prevent accidents.">当方の一方的過失以外の事故などについては…事故防止には万全を期してください。</li>
        </ul>
      </div>

      <label>
        <input type="checkbox" id="agree" name="agree" required>
        <span data-ja="上記注意事項を確認しました" data-en="I have read and agree to the above">上記注意事項を確認しました</span>
      </label>

      <button type="submit" class="btn" data-ja="送信" data-en="Submit">送信</button>
    </form>
    <p id="msg"></p>
  </main>

  <script>
    const now = new Date();
    document.getElementById('visitDate').value = now.toISOString().slice(0,10);
    document.getElementById('visitTime').value = now.toTimeString().slice(0,5);

    function addNamePair() {
      const section = document.getElementById('nameSection');
      const count = section.querySelectorAll('.name-pair').length;
      if (count >= 5) return alert(lang==='en' ? 'Up to 5 entries' : '最大5名までです');
      const div = document.createElement('div');
      div.className = 'name-pair';
      div.innerHTML = `
        <input type="text" placeholder="${lang==='en'?'Name':'お名前'}" required>
        <input type="number" placeholder="${lang==='en'?'Card No.':'VC No.'}" required>
      `;
      section.appendChild(div);
    }

    document.getElementById('visitorForm').addEventListener('submit', async e => {
      e.preventDefault();
      const fields = {};
      ['visitDate','visitTime','leaveTime','company'].forEach(id =>
        fields[id] = document.getElementById(id).value
      );
      document.querySelectorAll('.name-pair').forEach((pair,i) => {
        fields[`name_${i+1}`] = pair.children[0].value.trim();
        fields[`vc_${i+1}`]   = pair.children[1].value.trim();
      });
      fields.purpose = [...document.querySelectorAll('input[name="purpose"]:checked')]
        .map(el => el.value);
      fields.agree = document.getElementById('agree').checked;

      try {
        const res = await fetch('/.netlify/functions/submit',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(fields)
        });
        const result = await res.json();
        document.getElementById('msg').textContent =
          res.ok
            ? (lang==='en'?'Submission successful. Thank you.':'送信が完了しました。ありがとうございました。')
            : (lang==='en'?'Error: ':'エラー：') + result.message;
        if(res.ok) e.target.reset();
      } catch(err) {
        document.getElementById('msg').textContent =
          (lang==='en'?'Submission failed: ':'送信エラー：') + err.message;
      }
    });

    let lang = 'ja';
    function setLang(l) {
      lang = l;
      document.querySelectorAll('[data-ja]').forEach(el => {
        const text = el.dataset[l];
        if (!text) return;
        if (el.tagName==='INPUT' || el.tagName==='BUTTON') {
          if (el.hasAttribute('value')) el.value = text;
          else if (el.placeholder) el.placeholder = el.dataset[l+'-placeholder']||el.placeholder;
        } else {
          el.textContent = text;
        }
      });
    }
  </script>
</body>
</html>
